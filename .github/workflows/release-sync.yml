name: RELEASE-SYNC

on:
  release:
    types: [ released, prereleased ]

env:
  CLI_REPO: 'apecloud/kbcli'
  GITLAB_KBCLI_PROJECT_ID: 85948

jobs:
  update-release-kbcli:
    name: Update Release kbcli
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: update release ${{ env.CLI_NAME }} latest
        run: |
          LATEST_RELEASE_TAG=`bash ${{ github.workspace }}/.github/utils/utils.sh \
            --type 4 \
            --github-token ${{ secrets.PERSONAL_ACCESS_TOKEN }}`
          
          bash ${{ github.workspace }}/.github/utils/utils.sh \
            --type 5 \
            --tag-name $LATEST_RELEASE_TAG \
            --github-repo ${{ env.CLI_REPO }} \
            --github-token ${{ secrets.PERSONAL_ACCESS_TOKEN }}
          
          bash ${{ github.workspace }}/.github/utils/release_gitlab.sh \
            --type 4 \
            --tag-name $LATEST_RELEASE_TAG \
            --project-id ${{ env.GITLAB_KBCLI_PROJECT_ID }} \
            --access-token ${{ secrets.GITLAB_ACCESS_TOKEN }}
