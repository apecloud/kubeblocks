apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.12.1
  labels:
    app.kubernetes.io/name: kubeblocks
  name: componentversions.apps.kubeblocks.io
spec:
  group: apps.kubeblocks.io
  names:
    kind: ComponentVersion
    listKind: ComponentVersionList
    plural: componentversions
    singular: componentversion
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: ComponentVersion is the Schema for the componentversions API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: ComponentVersionSpec defines the desired state of ComponentVersion
            properties:
              components:
                description: Components is a list of component instances within this
                  ComponentVersion.
                items:
                  description: ComponentInstance represents an instance of a component
                    within a ComponentVersion.
                  properties:
                    apps:
                      description: Apps is a list of applications within this component.
                      items:
                        description: ComponentApp represents an application within
                          a component.
                        properties:
                          appVersions:
                            description: AppVersions is a list of versions associated
                              with this application.
                            items:
                              description: ComponentAppVersion represents the version
                                information for a specific application.
                              properties:
                                image:
                                  description: Image is the container image associated
                                    with this application version.
                                  maxLength: 128
                                  type: string
                                  x-kubernetes-validations:
                                  - message: Image is immutable
                                    rule: self == oldSelf
                                version:
                                  description: Version is the version number of the
                                    application.
                                  maxLength: 64
                                  type: string
                                  x-kubernetes-validations:
                                  - message: Version is immutable
                                    rule: self == oldSelf
                              required:
                              - image
                              - version
                              type: object
                            maxItems: 128
                            minItems: 1
                            type: array
                            x-kubernetes-validations:
                            - message: Duplicated app version
                              rule: self.all(x, size(self.filter(c, c == x)) == 1)
                            - message: AppVersion may only be added
                              rule: oldSelf.all(x, x in self)
                          name:
                            description: Name is the name of the application, it indicates
                              the name of container within the referred ComponentDefinition.
                            type: string
                            x-kubernetes-validations:
                            - message: Name is immutable
                              rule: self == oldSelf
                        required:
                        - appVersions
                        - name
                        type: object
                      maxItems: 128
                      type: array
                      x-kubernetes-validations:
                      - message: Duplicated component app
                        rule: self.all(x, size(self.filter(c, c.name == x.name)) ==
                          1)
                      - message: App can not be deleted
                        rule: oldSelf.all(x, size(self.filter(c, c.name == x.name))
                          == 1)
                    compDefinition:
                      description: CompDefinition is the reference to the ComponentDefinition
                        of this component.
                      type: string
                      x-kubernetes-validations:
                      - message: CompDefinition is immutable
                        rule: self == oldSelf
                  required:
                  - compDefinition
                  type: object
                maxItems: 128
                minItems: 1
                type: array
                x-kubernetes-validations:
                - message: Duplicated component
                  rule: self.all(x, size(self.filter(c, c.componentDef == x.componentDef))
                    == 1)
                - message: Component can not be deleted
                  rule: oldSelf.all(x, size(self.filter(c, c.componentDef == x.componentDef))
                    == 1)
            required:
            - components
            type: object
          status:
            description: ComponentVersionStatus defines the observed state of ComponentVersion
            properties:
              message:
                description: Extra message for current phase.
                type: string
              observedGeneration:
                description: ObservedGeneration is the most recent generation observed
                  for this ComponentVersion.
                format: int64
                type: integer
              phase:
                description: Phase valid values are ``, `Available`, 'Unavailable`.
                  Available is ComponentVersion become available, and can be used
                  for co-related objects.
                enum:
                - Available
                - Unavailable
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
