# API scope: cluster
# AppVersion
apiVersion: "dbaas.infracreate.com/v1alpha1"
kind:       "AppVersion"
metadata:
  name:      "appversion-mongodb-3.4"
spec:
  #  # ref ClusterDefinition
  #  clusterDefinitionRef: a-vendor-mongodbcluster
  #  components:
  #  - name: mongos # component name in ClusterDefinition
  #    # containers 字段覆盖 ClusterDefinition 里的同字段
  #    containers: []<metav1 container spec>
  #    - name:
  #      ports:
  #      volumeMounts: []<pod.spec.containers.volumeMounts>
  #      - mountPath:
  #        name:
  #    # service 字段覆盖 ClusterDefinition 里的同字段
  #    # type ServiceSpec struct from k8s.io/core/v1
  #    service:
  #      ports:
  #      - protocol: TCP
  #        port: 80
  #        targetPort: 9376
  # ref ClusterDefinition
  clusterDefinitionRef: a-vendor-mongodbcluster
  components:
    - type: mongos # component.typeName name in ClusterDefinition
      containers: # <metav1 container spec>
        - name: mongod
          ports: []
          env:
            - name: MONGO_INITDB_ROOT_USERNAME
              value: root
            - name: MONGO_INITDB_ROOT_PASSWORD
              value: example
          command: []
          args: []
          image: mongodb:20190725_1.1.8
          imagePullPolicy: IfNotPresent
          volumeMounts:
            - mountPath: /data
              name: data
            - mountPath: /log
              name: log
    - type: configserver
      containers:
        - name: mongod
          env:
            - name: MONGO_INITDB_ROOT_USERNAME
              value: root
            - name: MONGO_INITDB_ROOT_PASSWORD
              value: example
          image: mongodb:20190725_1.1.8
          imagePullPolicy: IfNotPresent
    - type: shard
      containers:
        - name: mongod
          env:
            - name: MONGO_INITDB_REPLICASET_ID
              # env generated by dbaas
              value: ${OPENDBAAS_SHARD_ID}
            - name: MONGO_INITDB_ROOT_USERNAME
              value: root
            - name: MONGO_INITDB_ROOT_PASSWORD
              value: example
          image: mongodb:20190725_1.1.8
          imagePullPolicy: IfNotPresent

status:
  # phase - in list of [Running, Failed]
  phase: Failed
  message: "clusterDefinitionRef not found"
