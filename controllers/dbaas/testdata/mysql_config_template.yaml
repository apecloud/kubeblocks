apiVersion: dbaas.kubeblocks.io/v1alpha1
kind: ConfigurationTemplate
metadata:
  name: mysql-tree-node-template-8.0
spec:
  # configmap reference
  tplRef: mysql-tree-node-template-8.0

  # top level mysql configuration type
  cfgSchemaTopLevelName: MysqlParameter

  # ConfigurationSchema that impose restrictions on engine parameter's rule
  configurationSchema:
    # schema: auto generate from cue scripts
    # example: ../../internal/configuration/testdata/mysql_openapi.json
    cue: |-
      // top level configuration type
      #MysqlParameter: {
          //  mysql server param: a set of name/value pairs.
          mysqld: {

            // [OFF|ON] default ON
            automatic_sp_privileges: string & "OFF" | "ON" | *"ON"

            // [1~65535] default ON
            auto_increment_increment: int & >= 1 & <= 65535 | *1

            // [4096~16777216] default 2G
            binlog_stmt_cache_size?: int & >= 4096 & <= 16777216 | *2097152

            // [0|1|2] default: 2
            innodb_autoinc_lock_mode?: int & 0 | 1 | 2 | *2

            // other parmeters
            // reference mysql parmeters
            ...
          }

          // ingore client parameter validate
          // mysql client: a set of name/value pairs.
          client?: {
            [string]: string
          } @protobuf(2,type=map<string,string>)
      }

      // configuration require
      configuration: #MysqlParameter & {
      }

  #  require db instance restart
  staticParameters:
    -

  # mysql configuration file format
  formatter: ini

  # Immutable, if set to true, ensures that data stored in the ConfigMap cannot be updated (only object metadata can be modified).
  # If set to true, Configmap object referenced by TplRef will also be modified to immutable
  # Defaulted to true
  # It is recommended to turn this option on only during the development or testing phase.
  immutable: true