{{ include "_logo" . | indent 34 }}

{{ template "_divider" }}

1. Get the application URL by running these commands:
{{- if contains "NodePort" .Values.service.type }}
  export NODE_PORT=$(kubectl get --namespace {{ .Release.Namespace }} -o jsonpath="{.spec.ports[0].nodePort}" services {{ include "kubeblocks.fullname" . }})
  export NODE_IP=$(kubectl get nodes --namespace {{ .Release.Namespace }} -o jsonpath="{.items[0].status.addresses[0].address}")
  echo http://$NODE_IP:$NODE_PORT
{{- else if contains "LoadBalancer" .Values.service.type }}
     NOTE: It may take a few minutes for the LoadBalancer IP to be available.
           You can watch the status of by running 'kubectl get --namespace {{ .Release.Namespace }} svc -w {{ include "kubeblocks.fullname" . }}'
  export SERVICE_IP=$(kubectl get svc --namespace {{ .Release.Namespace }} {{ include "kubeblocks.fullname" . }} --template "{{"{{ range (index .status.loadBalancer.ingress 0) }}{{.}}{{ end }}"}}")
  echo http://$SERVICE_IP:{{ .Values.service.port }}
{{- else if contains "ClusterIP" .Values.service.type }}
  export POD_NAME=$(kubectl get pods --namespace {{ .Release.Namespace }} -l "app.kubernetes.io/name={{ include "kubeblocks.name" . }},app.kubernetes.io/instance={{ .Release.Name }}" -o jsonpath="{.items[0].metadata.name}")
  export CONTAINER_PORT=$(kubectl get pod --namespace {{ .Release.Namespace }} $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")
  echo "Visit http://127.0.0.1:8080 to use your application"
  kubectl --namespace {{ .Release.Namespace }} port-forward $POD_NAME 8080:$CONTAINER_PORT
{{- end }}

{{ template "_divider" }}

{{ if .Values.prometheus.server.enabled }}
The Prometheus Server can be accessed via port {{ .Values.prometheus.server.service.servicePort }} on the following DNS name from within your cluster:

    {{ template "kubeblocks.prometheus.server.fullname" . }}.{{ template "kubeblocks.prometheus.namespace" . }}.svc.cluster.local
{{ if .Values.prometheus.server.ingress.enabled -}}
From outside the cluster, the prometheus server URL(s) are:

{{- range .Values.prometheus.server.ingress.hosts }}
    http://{{ . }}
{{- end }}
{{- else }}
Get the Prometheus Server URL by running these commands in the same shell:

{{- if contains "NodePort" .Values.prometheus.server.service.type }}

    export NODE_PORT=$(kubectl get --namespace {{ template "kubeblocks.prometheus.namespace" . }} -o jsonpath="{.spec.ports[0].nodePort}" services {{ template "kubeblocks.prometheus.server.fullname" . }})
    export NODE_IP=$(kubectl get nodes --namespace {{ template "kubeblocks.prometheus.namespace" . }} -o jsonpath="{.items[0].status.addresses[0].address}")
    echo http://$NODE_IP:$NODE_PORT
{{- else if contains "LoadBalancer" .Values.prometheus.server.service.type }}

    NOTE: It may take a few minutes for the LoadBalancer IP to be available.
          You can watch the status of by running 'kubectl get svc --namespace {{ template "kubeblocks.prometheus.namespace" . }} -w {{ template "kubeblocks.prometheus.server.fullname" . }}'

    export SERVICE_IP=$(kubectl get svc --namespace {{ template "kubeblocks.prometheus.namespace" . }} {{ template "kubeblocks.prometheus.server.fullname" . }} -o jsonpath='{.status.loadBalancer.ingress[0].ip}')
    echo http://$SERVICE_IP:{{ .Values.prometheus.server.service.servicePort }}
{{- else if contains "ClusterIP"  .Values.prometheus.server.service.type }}

    export POD_NAME=$(kubectl get pods --namespace {{ template "kubeblocks.prometheus.namespace" . }} -l "app=prometheus,component={{ .Values.prometheus.server.name }}" -o jsonpath="{.items[0].metadata.name}")
    kubectl --namespace {{ template "kubeblocks.prometheus.namespace" . }} port-forward $POD_NAME 9090
{{- end }}
{{- end }}

{{- if .Values.prometheus.server.persistentVolume.enabled }}
{{- else }}

#################################################################################
######   WARNING: Persistence is disabled!!! You will lose your data when   #####
######            the Prometheus Server pod is terminated.                  #####
#################################################################################

{{- end }}
{{- end }}

{{ template "_divider" }}
{{ if .Values.prometheus.alertmanager.enabled }}
The Prometheus Alertmanager can be accessed via port {{ .Values.prometheus.alertmanager.service.servicePort }} on the following DNS name from within your cluster:

    {{ template "kubeblocks.prometheus.alertmanager.fullname" . }}.{{ template "kubeblocks.prometheus.namespace" . }}.svc.cluster.local
{{ if .Values.prometheus.alertmanager.ingress.enabled -}}
From outside the cluster, the alertmanager URL(s) are:

{{- range .Values.prometheus.alertmanager.ingress.hosts }}
    http://{{ . }}
{{- end }}
{{- else }}
Get the Prometheus Alertmanager URL by running these commands in the same shell:

{{- if contains "NodePort" .Values.prometheus.alertmanager.service.type }}

    export NODE_PORT=$(kubectl get --namespace {{ template "kubeblocks.prometheus.namespace" . }} -o jsonpath="{.spec.ports[0].nodePort}" services {{ template "kubeblocks.prometheus.alertmanager.fullname" . }})
    export NODE_IP=$(kubectl get nodes --namespace {{ template "kubeblocks.prometheus.namespace" . }} -o jsonpath="{.items[0].status.addresses[0].address}")
    echo http://$NODE_IP:$NODE_PORT
{{- else if contains "LoadBalancer" .Values.prometheus.alertmanager.service.type }}

    NOTE: It may take a few minutes for the LoadBalancer IP to be available.
          You can watch the status of by running 'kubectl get svc --namespace {{ template "kubeblocks.prometheus.namespace" . }} -w {{ template "kubeblocks.prometheus.alertmanager.fullname" . }}'

    export SERVICE_IP=$(kubectl get svc --namespace {{ template "kubeblocks.prometheus.namespace" . }} {{ template "kubeblocks.prometheus.alertmanager.fullname" . }} -o jsonpath='{.status.loadBalancer.ingress[0].ip}')
    echo http://$SERVICE_IP:{{ .Values.prometheus.alertmanager.service.servicePort }}
{{- else if contains "ClusterIP"  .Values.prometheus.alertmanager.service.type }}

    export POD_NAME=$(kubectl get pods --namespace {{ template "kubeblocks.prometheus.namespace" . }} -l "app=prometheus,component={{ .Values.prometheus.alertmanager.name }}" -o jsonpath="{.items[0].metadata.name}")
    kubectl --namespace {{ template "kubeblocks.prometheus.namespace" . }} port-forward $POD_NAME 9093
{{- end }}
{{- end }}

{{- if .Values.prometheus.alertmanager.persistentVolume.enabled }}
{{- else }}

#################################################################################
######   WARNING: Persistence is disabled!!! You will lose your data when   #####
######            the Prometheus AlertManager pod is terminated.            #####
#################################################################################

{{- end }}
{{- end }}

{{ template "_divider" }}
{{ if .Values.grafana.enabled }}
The Grafana Server can be accessed via port {{ .Values.grafana.service.port }} on the following DNS name from within your cluster:

    {{ template "kubeblocks.grafana.fullname" . }}.{{ template "kubeblocks.grafana.namespace" . }}.svc.cluster.local
{{ if .Values.grafana.ingress.enabled -}}
If you bind Grafana Server to {{ .Values.grafana.service.port }}, please update values in values.yaml and reinstall:
   ```
   securityContext:
     runAsUser: 0
     runAsGroup: 0
     fsGroup: 0

   command:
   - "setcap"
   - "'cap_net_bind_service=+ep'"
   - "/usr/sbin/grafana-server &&"
   - "sh"
   - "/run.sh"
   ```
Details refer to https://grafana.com/docs/installation/configuration/#http-port.
Or Grafana Server would always crash.

From outside the cluster, the Grafana Server URL(s) are:

{{- range .Values.grafana.ingress.hosts }}
    http://{{ . }}
{{- end }}
{{- else }}
Get the Grafana Server URL by running these commands in the same shell:

{{- if contains "NodePort" .Values.grafana.service.type }}

    export NODE_PORT=$(kubectl get --namespace {{ template "kubeblocks.grafana.namespace" . }} -o jsonpath="{.spec.ports[0].nodePort}" services {{ template "kubeblocks.grafana.fullname" . }})
    export NODE_IP=$(kubectl get nodes --namespace {{ template "kubeblocks.grafana.namespace" . }} -o jsonpath="{.items[0].status.addresses[0].address}")
    echo http://$NODE_IP:$NODE_PORT
{{- else if contains "LoadBalancer" .Values.grafana.service.type }}

    NOTE: It may take a few minutes for the LoadBalancer IP to be available.
          You can watch the status of by running 'kubectl get svc --namespace {{ template "kubeblocks.grafana.namespace" . }} -w {{ template "kubeblocks.grafana.fullname" . }}'

    export SERVICE_IP=$(kubectl get svc --namespace {{ template "kubeblocks.grafana.namespace" . }} {{ template "kubeblocks.grafana.fullname" . }} -o jsonpath='{.status.loadBalancer.ingress[0].ip}')
    echo http://$SERVICE_IP:{{ .Values.grafana.service.port }}
{{- else if contains "ClusterIP"  .Values.grafana.service.type }}

    export POD_NAME=$(kubectl get pods --namespace {{ template "kubeblocks.grafana.namespace" . }} -l "app.kubernetes.io/name=grafana,app.kubernetes.io/instance={{ .Release.Name }}" -o jsonpath="{.items[0].metadata.name}")
    kubectl --namespace {{ template "kubeblocks.grafana.namespace" . }} port-forward $POD_NAME 3000
{{- end }}
{{- end }}

Get your '{{ .Values.grafana.adminUser }}' user password by running:

   kubectl get secret --namespace {{ template "kubeblocks.grafana.namespace" . }} {{ template "kubeblocks.grafana.fullname" . }} -o jsonpath="{.data.admin-password}" | base64 --decode ; echo

Login with the password and the username: {{ .Values.grafana.adminUser }}
{{- if .Values.grafana.persistence.enabled }}
{{- else }}

#################################################################################
######   WARNING: Persistence is disabled!!! You will lose your data when   #####
######            the Grafana pod is terminated.                            #####
#################################################################################

{{- end }}
{{- end }}
