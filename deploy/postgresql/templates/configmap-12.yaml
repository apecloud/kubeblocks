apiVersion: v1
kind: ConfigMap
metadata:
  name: postgresql12-configuration
  labels:
    {{- include "postgresql.labels" . | nindent 4 }}
data:
  postgresql.conf: |-
    {{- .Files.Get "config/pg12-config.tpl" | nindent 4 }}
  # TODO: check if it should trust all
  pg_hba.conf: |
    host     all             all             0.0.0.0/0               trust
    host     all             all             ::/0                    trust
    local    all             all                                     trust
    host     all             all             127.0.0.1/32            trust
    host     all             all             ::1/128                 trust
    local     replication     all                                    trust
    host      replication     all             0.0.0.0/0               md5
    host      replication     all             ::/0                    md5
  kb_restore.conf: |
    method: kb_restore_from_backup
    kb_restore_from_backup:
      command: bash /home/postgres/pgdata/kb_restore/kb_restore.sh
      keep_existing_recovery_conf: false
      recovery_conf:
        restore_command: cp /home/postgres/pgdata/pgroot/arch/%f %p
        recovery_target_timeline: latest
  kb_pitr.conf: |
    method: kb_restore_from_time
    kb_restore_from_time:
      command: bash /home/postgres/pgdata/kb_restore/kb_restore.sh
      keep_existing_recovery_conf: false
      recovery_conf: {}