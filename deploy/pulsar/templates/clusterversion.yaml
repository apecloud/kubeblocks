apiVersion: apps.kubeblocks.io/v1alpha1
kind: ClusterVersion
metadata:
  name: pulsar-{{ default .Chart.AppVersion .Values.clusterVersionOverride }}
  labels:
    {{- include "pulsar.labels" . | nindent 4 }}
spec:
  clusterDefinitionRef: pulsar
  componentVersions:
    - componentDefRef: bookies
      versionsContext:
        initContainers:
          - name: init-bookies
            image: {{ .Values.bookies.image.repository }}:{{ .Values.bookies.image.tag }}
            imagePullPolicy: {{ default "IfNotPresent" .Values.bookies.image.pullPolicy }}
        containers:
          - name: bookies
            image: {{ .Values.bookies.image.repository }}:{{ .Values.bookies.image.tag }}
            imagePullPolicy: {{ default "IfNotPresent" .Values.bookies.image.pullPolicy }}
    - componentDefRef: zookeeper
      versionsContext:
        containers:
          - name: zookeeper
            image: {{ .Values.zookeeper.image.repository }}:{{ .Values.zookeeper.image.tag }}
            imagePullPolicy: {{ default "IfNotPresent" .Values.zookeeper.image.pullPolicy }}
    - componentDefRef: broker
      versionsContext:
        containers:
          - name: broker
            image: {{ .Values.broker.image.repository }}:{{ .Values.broker.image.tag }}
            imagePullPolicy: {{ default "IfNotPresent" .Values.broker.image.pullPolicy }}
        initContainers:
        - name: init-broker-cluster
          image: {{ .Values.broker.image.repository }}:{{ .Values.broker.image.tag }}
          imagePullPolicy: {{ default .Values.broker.image.pullPolicy "IfNotPresent" }}
        - name: init-sysctl
          image: {{ .Values.broker.image.repository }}:{{ .Values.broker.image.tag }}
          imagePullPolicy: {{ default .Values.broker.image.pullPolicy "IfNotPresent" }}
    - componentDefRef: proxy
      versionsContext:
        containers:
          - name: proxy
            image: {{ .Values.proxy.image.repository }}:{{ .Values.proxy.image.tag }}
            imagePullPolicy: {{ default "IfNotPresent" .Values.proxy.image.pullPolicy }}
        initContainers:
        - name: check-broker
          image: {{ .Values.proxy.image.repository }}:{{ .Values.proxy.image.tag }}
          imagePullPolicy: {{ default .Values.proxy.image.pullPolicy "IfNotPresent" }}