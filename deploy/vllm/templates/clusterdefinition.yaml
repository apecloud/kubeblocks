apiVersion: apps.kubeblocks.io/v1alpha1
kind: ClusterDefinition
metadata:
  name: vllm
  labels:
    {{- include "llm.labels" . | nindent 4}}
spec:
  componentDefs:
    - name: vllm
      workloadType: Stateless
      characterType: vllm
      scriptSpecs:
        - name: vllm-scripts
          templateRef: vllm-scripts
          namespace: {{ .Release.Namespace }}
          volumeName: scripts
          defaultMode: 493
      service:
        ports:
          - name: model
            port: 8080
            targetPort: model
      podSpec:
        tolerations:
          - key: "cttest"
            operator: "Equal"
            value: "true"
        volumes:
          - name: model-store
            emptyDir: {}
        containers:
          - name: vllm
            imagePullPolicy: {{default .Values.image.pullPolicy "IfNotPresent"}}
            securityContext:
              runAsUser: 0
            terminationMessagePath: /dev/termination-log
            terminationMessagePolicy: File
            volumeMounts:
              - mountPath: /llm/config/
                name: config
              - name: scripts
                mountPath: /scripts
              - mountPath: /llm/storage
                name: model-store
            command:
              - /scripts/start.sh
            ports:
              - name: model
                containerPort: 8080
            # startupProbe:
            #   failureThreshold: 180
            #   httpGet:
            #     path: /generate
            #     port: model
            #     scheme: HTTP
            #   periodSeconds: 10
            #   successThreshold: 1
            #   timeoutSeconds: 3
            # readinessProbe:
            #   failureThreshold: 18
            #   httpGet:
            #     path: /generate
            #     port: model
            #     scheme: HTTP
            #   periodSeconds: 10
            #   successThreshold: 1
            #   timeoutSeconds: 3
  connectionCredential:
    username: root
    password: ""