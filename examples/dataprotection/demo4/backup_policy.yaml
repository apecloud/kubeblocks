# Standard Kubernetes Kind declaration. Required.
apiVersion: dataprotection.infracreate.com/v1alpha1
# Standard Kubernetes Kind declaration. Required.
kind: BackupPolicy
# Standard Kubernetes metadata. Required.
metadata:
  # Backup name. Maybe any valid Kubernetes object name. Required.
  name: backup-policy-demo
# Parameters about the backup. Required.
spec:
  # schedule will be ignored when create a backup session in manual.
  # [optional]
  schedule: "0 3 * * *"
  # The amount of time before this backup is eligible for garbage collection. If not specified,
  # a default value of 30 days will be used. The default can be configured on the server
  # if set to infinity,
  # valid value: 30d      : 30 days:
  #              infinity :  backups will not be cleaned.
  ttl: 168h0m0s

  backupToolName: xtrabackup-mysql

  # inherit from backup config
  backupPolicyTemplateName: backup-config-mysql
  # database cluster service selector
  target:
    databaseEngine: mysql
    # ref definition is more general, but need to integrate with dbaas, define labelsSelector instead.
    labelsSelector:
      matchLabels:
        app.kubernetes.io/instance: wesql-cluster

    secretName: wesql-cluster

  # array of database volumes storage for backup.
  targetVolume:
    name: mysql-persistent-storage
    persistentVolumeClaim:
      claimName: data-wesql-cluster-replicasets-primary-1

  # array of remote volumes from CSI driver definition.
  remoteVolumes:
    - name: backup-remote-volume
      persistentVolumeClaim:
        claimName: backup-s3-pvc


  # !!DISCUSS Number of backup retries on fail.
  onFailAttempted: 3
