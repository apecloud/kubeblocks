apiVersion: troubleshoot.sh/v1beta2
kind: HostPreflight
metadata:
  name: host-utility
spec:
  collectors:
    - cpu: {}
  analyzers:
    - cpu:
        checkName: "Number of CPUs"
        outcomes:
          - fail:
              when: "count < 2"
              message: At least 2 CPU cores are required, and 4 CPU cores are recommended
          - warn:
              when: "count < 4"
              message: At least 4 CPU cores are recommended
          - pass:
              message: This server has at least 4 CPU cores
  extendCollectors:
    - hostUtility :
        collectorName: helmCheck
        utilityName: helm
    - hostUtility :
        collectorName: awsCheck
        utilityName: aws
  extendAnalyzers:
    - hostUtility:
        collectorName: helmCheck
        outcomes:
          - pass:
              message: ok.
          - fail:
              message: no helm
    - hostUtility:
        collectorName: awsCheck
        outcomes:
          - pass:
              message: ok.
          - fail:
              message: no aws