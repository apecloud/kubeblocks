---
# Source: apecloud-mysql/templates/configconstraint.yaml
apiVersion: apps.kubeblocks.io/v1alpha1
kind: ConfigConstraint
metadata:
  name: mysql8.0-config-constraints
  labels:
    helm.sh/chart: apecloud-mysql-0.5.0-beta.24
    app.kubernetes.io/name: apecloud-mysql
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "8.0.30"
    app.kubernetes.io/managed-by: Helm
spec:
  # configmap reference
  # tplRef: mysql-3node-tpl-8.0
  reloadOptions:
    tplScriptTrigger:
      sync: true
      scriptConfigMapRef: mysql-reload-script
      namespace: default

  # top level mysql configuration type
  cfgSchemaTopLevelName: MysqlParameter

  # ConfigurationSchema that impose restrictions on engine parameter's rule
  configurationSchema:
    # schema: auto generate from mmmcue scripts
    # example: ../../internal/configuration/testdata/mysql_openapi.json
    cue: |-
      //Copyright (C) 2022-2023 ApeCloud Co., Ltd
      //
      //This file is part of KubeBlocks project
      //
      //This program is free software: you can redistribute it and/or modify
      //it under the terms of the GNU Affero General Public License as published by
      //the Free Software Foundation, either version 3 of the License, or
      //(at your option) any later version.
      //
      //This program is distributed in the hope that it will be useful
      //but WITHOUT ANY WARRANTY; without even the implied warranty of
      //MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
      //GNU Affero General Public License for more details.
      //
      //You should have received a copy of the GNU Affero General Public License
      //along with this program.  If not, see <http://www.gnu.org/licenses/>.
      
      #MysqlParameter: {
      
      	// reference aws rds params: https://console.amazonaws.cn/rds/home?region=cn-north-1#parameter-groups-detail:ids=default.mysql8.0;type=DbParameterGroup;editing=false
      	// auto generate by cue_generate.go
      
      	// Automatically set all granted roles as active after the user has authenticated successfully.
      	activate_all_roles_on_login: string & "0" | "1" | "OFF" | "ON" | *"0"
      
      	// Controls whether user-defined functions that have only an xxx symbol for the main function can be loaded
      	"allow-suspicious-udfs"?: string & "0" | "1" | "OFF" | "ON"
    
      	...
      }
      
      // SectionName is section name
      [SectionName=_]: #MysqlParameter


  # mysql configuration file format
  formatterConfig:
    format: ini
    iniConfig:
      sectionName: mysqld
