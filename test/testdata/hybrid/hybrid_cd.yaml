apiVersion: dbaas.kubeblocks.io/v1alpha1
kind: ClusterDefinition
metadata:
  name: %s
spec:
  components:
  - antiAffinity: false
    componentType: Stateless
    defaultReplicas: 1
    minReplicas: 0
    podSpec:
      containers:
      - name: busybox
    typeName: stateless
  - antiAffinity: false
    componentType: Consensus
    typeName: consensus
    logConfigs:
    - filePathPattern: /data/mysql/log/mysqld.err
      name: error
    podSpec:
      containers:
      - name: mysql
    consensusSpec:
      followers:
      - accessMode: Readonly
        name: follower
      leader:
        accessMode: ReadWrite
        name: leader
      updateStrategy: BestEffortParallel
    defaultReplicas: 3
  - typeName: stateful
    pdbSpec:
      minAvailable: 1
    componentType: Stateful
    defaultReplicas: 3
    podSpec:
      containers:
      - name: mysql
        ports:
        - containerPort: 3306
          name: mysql
          protocol: TCP
  type: state.mysql